/* $script.js JS loader & dependency manager https://github.com/ded/script.js (c) Dustin Diaz 2014 | License MIT  */

(function(e,t){typeof module!="undefined"&&module.exports?module.exports=t():typeof define=="function"&&define.amd?define(t):this[e]=t()})("$script",function(){function p(e,t){for(var n=0,i=e.length;n<i;++n)if(!t(e[n]))return r;return 1}function d(e,t){p(e,function(e){return t(e),1})}function v(e,t,n){function g(e){return e.call?e():u[e]}function y(){if(!--h){u[o]=1,s&&s();for(var e in f)p(e.split("|"),g)&&!d(f[e],g)&&(f[e]=[])}}e=e[i]?e:[e];var r=t&&t.call,s=r?t:n,o=r?e.join(""):t,h=e.length;return setTimeout(function(){d(e,function t(e,n){if(e===null)return y();!n&&!/^https?:\/\//.test(e)&&c&&(e=e.indexOf(".js")===-1?c+e+".js":c+e);if(l[e])return o&&(a[o]=1),l[e]==2?y():setTimeout(function(){t(e,!0)},0);l[e]=1,o&&(a[o]=1),m(e,y)})},0),v}function m(n,r){var i=e.createElement("script"),u;i.onload=i.onerror=i[o]=function(){if(i[s]&&!/^c|loade/.test(i[s])||u)return;i.onload=i[o]=null,u=1,l[n]=2,r()},i.async=1,i.src=h?n+(n.indexOf("?")===-1?"?":"&")+h:n,t.insertBefore(i,t.lastChild)}var e=document,t=e.getElementsByTagName("head")[0],n="string",r=!1,i="push",s="readyState",o="onreadystatechange",u={},a={},f={},l={},c,h;return v.get=m,v.order=function(e,t,n){(function r(i){i=e.shift(),e.length?v(i,r):v(i,t,n)})()},v.path=function(e){c=e},v.urlArgs=function(e){h=e},v.ready=function(e,t,n){e=e[i]?e:[e];var r=[];return!d(e,function(e){u[e]||r[i](e)})&&p(e,function(e){return u[e]})?t():!function(e){f[e]=f[e]||[],f[e][i](t),n&&n(r)}(e.join("|")),v},v.done=function(e){v([null],e)},v});

/* jQuery Poshytip */	

(function($){var tips=[],reBgImage=/^url\(["']?([^"'\)]*)["']?\);?$/i,rePNG=/\.png$/i,ie6=!!window.createPopup&&document.documentElement.currentStyle.minWidth=='undefined'; $.Poshytip=function(elm,options){this.$elm=$(elm);this.opts=$.extend({},$.fn.poshytip.defaults,options);this.$tip=$(['<div class="',this.opts.className,'">','<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>','</div>'].join('')).appendTo(document.body);this.$arrow=this.$tip.find('div.tip-arrow');this.$inner=this.$tip.find('div.tip-inner');this.disabled=false;this.content=null;this.init();};$.Poshytip.handleWindowResize=function(){$.each(tips,function(){this.refresh(true);});};$(window).on('resize.poshytip',$.Poshytip.handleWindowResize);$.Poshytip.prototype={init:function(){tips.push(this);var title=this.$elm.attr('title');this.$elm.data('title.poshytip',title!==undefined?title:null).data('poshytip',this);if(this.opts.showOn!='none'){this.$elm.bind({'mouseenter.poshytip':$.proxy(this.mouseenter,this),'mouseleave.poshytip':$.proxy(this.mouseleave,this)});switch(this.opts.showOn){case'hover':if(this.opts.alignTo=='cursor')
this.$elm.bind('mousemove.poshytip',$.proxy(this.mousemove,this));if(this.opts.allowTipHover)
this.$tip.hover($.proxy(this.clearTimeouts,this),$.proxy(this.mouseleave,this));break;case'focus':this.$elm.bind({'focus.poshytip':$.proxy(this.showDelayed,this),'blur.poshytip':$.proxy(this.hideDelayed,this)});break;}}},mouseenter:function(e){if(this.disabled)
return true;this.$elm.attr('title','');if(this.opts.showOn=='focus')
return true;this.showDelayed();},mouseleave:function(e){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===e.relatedTarget||jQuery.contains(this.$tip[0],e.relatedTarget)))
return true;if(!this.$tip.data('active')){var title=this.$elm.data('title.poshytip');if(title!==null)
this.$elm.attr('title',title);}
if(this.opts.showOn=='focus')
return true;this.hideDelayed();},mousemove:function(e){if(this.disabled)
return true;this.eventX=e.pageX;this.eventY=e.pageY;if(this.opts.followCursor&&this.$tip.data('active')){this.calcPos();this.$tip.css({left:this.pos.l,top:this.pos.t});if(this.pos.arrow)
this.$arrow[0].className='tip-arrow tip-arrow-'+this.pos.arrow;}},show:function(){if(this.disabled||(this.$tip&&this.$tip.data('active')))
return;this.reset();this.update();if(!this.content)
return;this.display();if(this.opts.timeOnScreen)
this.hideDelayed(this.opts.timeOnScreen);},showDelayed:function(timeout){this.clearTimeouts();this.showTimeout=setTimeout($.proxy(this.show,this),typeof timeout=='number'?timeout:this.opts.showTimeout);},hide:function(){if(this.disabled||(this.$tip&&!this.$tip.data('active')))
return;this.display(true);},hideDelayed:function(timeout){this.clearTimeouts();this.hideTimeout=setTimeout($.proxy(this.hide,this),typeof timeout=='number'?timeout:this.opts.hideTimeout);},reset:function(){if(this.$tip){this.$tip.queue([]).detach().css('visibility','hidden').data('active',false);}
this.$inner.find('*').poshytip('hide');if(this.opts.fade&&this.$tip)
this.$tip.css('opacity',this.opacity);this.$arrow[0].className='tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left';this.asyncAnimating=false;},update:function(content,dontOverwriteOption){if(this.disabled)
return;var async=content!==undefined;if(async){if(!dontOverwriteOption)
this.opts.content=content;if(!this.$tip.data('active'))
return;}else{content=this.opts.content;}
var self=this,newContent=typeof content=='function'?content.call(this.$elm[0],function(newContent){self.update(newContent);}):content=='[title]'?this.$elm.data('title.poshytip'):content;if(this.content!==newContent){this.$inner.empty().append(newContent);this.content=newContent;}
this.refresh(async);},refresh:function(async){if(this.disabled||this.$tip===undefined)
return;if(async){if(!this.$tip.data('active'))
return;var currPos={left:this.$tip.css('left'),top:this.$tip.css('top')};}
this.$tip.css({left:0,top:0}).appendTo(document.body);if(this.opacity===undefined)
this.opacity=this.$tip.css('opacity');var bgImage=this.$tip.css('background-image').match(reBgImage),arrow=this.$arrow.css('background-image').match(reBgImage);if(bgImage){var bgImagePNG=rePNG.test(bgImage[1]);if(ie6&&bgImagePNG){this.$tip.css('background-image','none');this.$inner.css({margin:0,border:0,padding:0});bgImage=bgImagePNG=false;}else{this.$tip.prepend('<table class="tip-table" border="0" cellpadding="0" cellspacing="0"><tr><td class="tip-top tip-bg-image" colspan="2"><span></span></td><td class="tip-right tip-bg-image" rowspan="2"><span></span></td></tr><tr><td class="tip-left tip-bg-image" rowspan="2"><span></span></td><td></td></tr><tr><td class="tip-bottom tip-bg-image" colspan="2"><span></span></td></tr></table>').css({border:0,padding:0,'background-image':'none','background-color':'transparent'}).find('.tip-bg-image').css('background-image','url("'+bgImage[1]+'")').end().find('td').eq(3).append(this.$inner);}
if(bgImagePNG&&!$.support.opacity)
this.opts.fade=false;}
if(arrow&&!$.support.opacity){if(ie6&&rePNG.test(arrow[1])){arrow=false;this.$arrow.css('background-image','none');}
this.opts.fade=false;}
var $table=this.$tip.find('> table.tip-table');if(ie6){this.$tip[0].style.width='';$table.width('auto').find('td').eq(3).width('auto');var tipW=this.$tip.width(),minW=parseInt(this.$tip.css('min-width')),maxW=parseInt(this.$tip.css('max-width'));if(!isNaN(minW)&&tipW<minW)
tipW=minW;else if(!isNaN(maxW)&&tipW>maxW)
tipW=maxW;this.$tip.add($table).width(tipW).eq(0).find('td').eq(3).width('100%');}else if($table[0]){$table.width('auto').find('td').eq(3).width('auto').end().end().width(document.defaultView&&document.defaultView.getComputedStyle&&parseFloat(document.defaultView.getComputedStyle(this.$tip[0],null).width)||this.$tip.width()).find('td').eq(3).width('100%');}
this.tipOuterW=this.$tip.outerWidth();this.tipOuterH=this.$tip.outerHeight();this.calcPos();if(arrow&&this.pos.arrow){this.$arrow[0].className='tip-arrow tip-arrow-'+this.pos.arrow;this.$arrow.css('visibility','inherit');}
if(async&&this.opts.refreshAniDuration){this.asyncAnimating=true;var self=this;this.$tip.css(currPos).animate({left:this.pos.l,top:this.pos.t},this.opts.refreshAniDuration,function(){self.asyncAnimating=false;});}else{this.$tip.css({left:this.pos.l,top:this.pos.t});}},display:function(hide){var active=(this.$tip&&this.$tip.data('active'))?true:false;if(active&&!hide||!active&&hide)
return;if(!this.$tip)return;this.$tip.stop();if((this.opts.slide&&this.pos.arrow||this.opts.fade)&&(hide&&this.opts.hideAniDuration||!hide&&this.opts.showAniDuration)){var from={},to={};if(this.opts.slide&&this.pos.arrow){var prop,arr;if(this.pos.arrow=='bottom'||this.pos.arrow=='top'){prop='top';arr='bottom';}else{prop='left';arr='right';}
var val=parseInt(this.$tip.css(prop));from[prop]=val+(hide?0:(this.pos.arrow==arr?-this.opts.slideOffset:this.opts.slideOffset));to[prop]=val+(hide?(this.pos.arrow==arr?this.opts.slideOffset:-this.opts.slideOffset):0)+'px';}
if(this.opts.fade){from.opacity=hide?this.$tip.css('opacity'):0;to.opacity=hide?0:this.opacity;}
this.$tip.css(from).animate(to,this.opts[hide?'hideAniDuration':'showAniDuration']);}
hide?this.$tip.queue($.proxy(this.reset,this)):this.$tip.css('visibility','inherit');if(active){var title=this.$elm.data('title.poshytip');if(title!==null)
this.$elm.attr('title',title);}
this.$tip.data('active',!active);},disable:function(){this.reset();this.disabled=true;},enable:function(){this.disabled=false;},destroy:function(){this.reset();this.$tip.remove();delete this.$tip;this.content=null;this.$elm.unbind('.poshytip').removeData('title.poshytip').removeData('poshytip');tips.splice($.inArray(this,tips),1);},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0;}
if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=0;}},calcPos:function(){var pos={l:0,t:0,arrow:''},$win=$(window),win={l:$win.scrollLeft(),t:$win.scrollTop(),w:$win.width(),h:$win.height()},xL,xC,xR,yT,yC,yB;if(this.opts.alignTo=='cursor'){xL=xC=xR=this.eventX;yT=yC=yB=this.eventY;}else{var elmOffset=this.$elm.offset(),elm={l:elmOffset.left,t:elmOffset.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};xL=elm.l+(this.opts.alignX!='inner-right'?0:elm.w);xC=xL+Math.floor(elm.w/2);xR=xL+(this.opts.alignX!='inner-left'?elm.w:0);yT=elm.t+(this.opts.alignY!='inner-bottom'?0:elm.h);yC=yT+Math.floor(elm.h/2);yB=yT+(this.opts.alignY!='inner-top'?elm.h:0);}
switch(this.opts.alignX){case'right':case'inner-left':pos.l=xR+this.opts.offsetX;if(this.opts.keepInViewport&&pos.l+this.tipOuterW>win.l+win.w)
pos.l=win.l+win.w-this.tipOuterW;if(this.opts.alignX=='right'||this.opts.alignY=='center')
pos.arrow='left';break;case'center':pos.l=xC-Math.floor(this.tipOuterW/2);if(this.opts.keepInViewport){if(pos.l+this.tipOuterW>win.l+win.w)
pos.l=win.l+win.w-this.tipOuterW;else if(pos.l<win.l)
pos.l=win.l;}
break;default:pos.l=xL-this.tipOuterW-this.opts.offsetX;if(this.opts.keepInViewport&&pos.l<win.l)
pos.l=win.l;if(this.opts.alignX=='left'||this.opts.alignY=='center')
pos.arrow='right';}
switch(this.opts.alignY){case'bottom':case'inner-top':pos.t=yB+this.opts.offsetY;if(!pos.arrow||this.opts.alignTo=='cursor')
pos.arrow='top';if(this.opts.keepInViewport&&pos.t+this.tipOuterH>win.t+win.h){pos.t=yT-this.tipOuterH-this.opts.offsetY;if(pos.arrow=='top')
pos.arrow='bottom';}
break;case'center':pos.t=yC-Math.floor(this.tipOuterH/2);if(this.opts.keepInViewport){if(pos.t+this.tipOuterH>win.t+win.h)
pos.t=win.t+win.h-this.tipOuterH;else if(pos.t<win.t)
pos.t=win.t;}
break;default:pos.t=yT-this.tipOuterH-this.opts.offsetY;if(!pos.arrow||this.opts.alignTo=='cursor')
pos.arrow='bottom';if(this.opts.keepInViewport&&pos.t<win.t){pos.t=yB+this.opts.offsetY;if(pos.arrow=='bottom')
pos.arrow='top';}}
this.pos=pos;}};$.fn.poshytip=function(options){if(typeof options=='string'){var args=arguments,method=options;Array.prototype.shift.call(args);if(method=='destroy'){this.die?this.die('mouseenter.poshytip').die('focus.poshytip'):$(document).undelegate(this.selector,'mouseenter.poshytip').undelegate(this.selector,'focus.poshytip');}
return this.each(function(){var poshytip=$(this).data('poshytip');if(poshytip&&poshytip[method])
poshytip[method].apply(poshytip,args);});}
var opts=$.extend({},$.fn.poshytip.defaults,options);if(!$('#poshytip-css-'+opts.className)[0])
$(['<style id="poshytip-css-',opts.className,'" type="text/css">','div.',opts.className,'{visibility:hidden;position:absolute;top:0;left:0;}','div.',opts.className,' table.tip-table, div.',opts.className,' table.tip-table td{margin:0;font-family:inherit;font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;vertical-align:middle;}','div.',opts.className,' td.tip-bg-image span{display:block;font:1px/1px sans-serif;height:',opts.bgImageFrameSize,'px;width:',opts.bgImageFrameSize,'px;overflow:hidden;}','div.',opts.className,' td.tip-right{background-position:100% 0;}','div.',opts.className,' td.tip-bottom{background-position:100% 100%;}','div.',opts.className,' td.tip-left{background-position:0 100%;}','div.',opts.className,' div.tip-inner{background-position:-',opts.bgImageFrameSize,'px -',opts.bgImageFrameSize,'px;}','div.',opts.className,' div.tip-arrow{visibility:hidden;position:absolute;overflow:hidden;font:1px/1px sans-serif;}','</style>'].join('')).appendTo('head');if(opts.liveEvents&&opts.showOn!='none'){var handler,deadOpts=$.extend({},opts,{liveEvents:false});switch(opts.showOn){case'hover':handler=function(){var $this=$(this);if(!$this.data('poshytip'))
$this.poshytip(deadOpts).poshytip('mouseenter');};this.live?this.live('mouseenter.poshytip',handler):$(document).delegate(this.selector,'mouseenter.poshytip',handler);break;case'focus':handler=function(){var $this=$(this);if(!$this.data('poshytip'))
$this.poshytip(deadOpts).poshytip('showDelayed');};this.live?this.live('focus.poshytip',handler):$(document).delegate(this.selector,'focus.poshytip',handler);break;}
return this;}
return this.each(function(){new $.Poshytip(this,opts);});}
$.fn.poshytip.defaults={content:'[title]',className:'tip-yellow',bgImageFrameSize:10,showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:'hover',liveEvents:false,alignTo:'cursor',alignX:'right',alignY:'top',offsetX:-22,offsetY:18,keepInViewport:true,allowTipHover:true,followCursor:false,fade:true,slide:true,slideOffset:8,showAniDuration:300,hideAniDuration:300,refreshAniDuration:200};})(jQuery);

/* JsHttpRequest */

(function(window){window.JsHttpRequest=function(){var t=this;t.onreadystatechange=null;t.readyState=0;t.responseText=null;t.responseXML=null;t.status=200;t.statusText="OK";t.responseJS=null;t.caching=false;t.loader=null;t.session_name="PHPSESSID";t._ldObj=null;t._reqHeaders=[];t._openArgs=null;t._errors={inv_form_el:'Invalid FORM element detected: name=%, tag=%',must_be_single_el:'If used, <form> must be a single HTML element in the list.',js_invalid:'JavaScript code generated by backend is invalid!\n%',url_too_long:'Cannot use so long query with GET request (URL is larger than % bytes)',unk_loader:'Unknown loader: %',no_loaders:'No loaders registered at all, please check JsHttpRequest.LOADERS array',no_loader_matched:'Cannot find a loader which may process the request. Notices are:\n%'}
t.abort=function(){with(this){if(_ldObj&&_ldObj.abort)_ldObj.abort();_cleanup();if(readyState==0){return;}
if(readyState==1&&!_ldObj){readyState=0;return;}
_changeReadyState(4,true);}}
t.open=function(method,url,asyncFlag,username,password){with(this){if(url.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)){this.loader=RegExp.$2?RegExp.$2:null;method=RegExp.$3;url=RegExp.$4;}
try{if(document.location.search.match(new RegExp('[&?]'+session_name+'=([^&?]*)'))||document.cookie.match(new RegExp('(?:;|^)\\s*'+session_name+'=([^;]*)'))){url+=(url.indexOf('?')>=0?'&':'?')+session_name+"="+this.escape(RegExp.$1);}}catch(e){}
_openArgs={method:(method||'').toUpperCase(),url:url,asyncFlag:asyncFlag,username:username!=null?username:'',password:password!=null?password:''}
_ldObj=null;_changeReadyState(1,true);return true;}}
t.send=function(content){if(!this.readyState){return;}
this._changeReadyState(1,true);this._ldObj=null;var queryText=[];var queryElem=[];if(!this._hash2query(content,null,queryText,queryElem))return;var hash=null;if(this.caching&&!queryElem.length){hash=this._openArgs.username+':'+this._openArgs.password+'@'+this._openArgs.url+'|'+queryText+"#"+this._openArgs.method;var cache=JsHttpRequest.CACHE[hash];if(cache){this._dataReady(cache[0],cache[1]);return false;}}
var loader=(this.loader||'').toLowerCase();if(loader&&!JsHttpRequest.LOADERS[loader])return this._error('unk_loader',loader);var errors=[];var lds=JsHttpRequest.LOADERS;for(var tryLoader in lds){var ldr=lds[tryLoader].loader;if(!ldr)continue;if(loader&&tryLoader!=loader)continue;var ldObj=new ldr(this);JsHttpRequest.extend(ldObj,this._openArgs);JsHttpRequest.extend(ldObj,{queryText:queryText.join('&'),queryElem:queryElem,id:(new Date().getTime())+""+JsHttpRequest.COUNT++,hash:hash,span:null});var error=ldObj.load();if(!error){this._ldObj=ldObj;JsHttpRequest.PENDING[ldObj.id]=this;return true;}
if(!loader){errors[errors.length]='- '+tryLoader.toUpperCase()+': '+this._l(error);}else{return this._error(error);}}
return tryLoader?this._error('no_loader_matched',errors.join('\n')):this._error('no_loaders');}
t.getAllResponseHeaders=function(){with(this){return _ldObj&&_ldObj.getAllResponseHeaders?_ldObj.getAllResponseHeaders():[];}}
t.getResponseHeader=function(label){with(this){return _ldObj&&_ldObj.getResponseHeader?_ldObj.getResponseHeader(label):null;}}
t.setRequestHeader=function(label,value){with(this){_reqHeaders[_reqHeaders.length]=[label,value];}}
t._dataReady=function(text,js){with(this){if(caching&&_ldObj)JsHttpRequest.CACHE[_ldObj.hash]=[text,js];responseText=responseXML=text;responseJS=js;if(js!==null){status=200;statusText="OK";}else{status=500;statusText="Internal Server Error";}
_changeReadyState(2);_changeReadyState(3);_changeReadyState(4);_cleanup();}}
t._l=function(args){var i=0,p=0,msg=this._errors[args[0]];while((p=msg.indexOf('%',p))>=0){var a=args[++i]+"";msg=msg.substring(0,p)+a+msg.substring(p+1,msg.length);p+=1+a.length;}
return msg;}
t._error=function(msg){msg=this._l(typeof(msg)=='string'?arguments:msg)
msg="JsHttpRequest: "+msg;if(!window.Error){throw msg;}else if((new Error(1,'test')).description=="test"){throw new Error(1,msg);}else{throw new Error(msg);}}
t._hash2query=function(content,prefix,queryText,queryElem){if(prefix==null)prefix="";if((''+typeof(content)).toLowerCase()=='object'){var formAdded=false;if(content&&content.parentNode&&content.parentNode.appendChild&&content.tagName&&content.tagName.toUpperCase()=='FORM'){content={form:content};}
for(var k in content){var v=content[k];if(v instanceof Function)continue;var curPrefix=prefix?prefix+'['+this.escape(k)+']':this.escape(k);var isFormElement=v&&v.parentNode&&v.parentNode.appendChild&&v.tagName;if(isFormElement){var tn=v.tagName.toUpperCase();if(tn=='FORM'){formAdded=true;}else if(tn=='INPUT'||tn=='TEXTAREA'||tn=='SELECT'){}else{return this._error('inv_form_el',(v.name||''),v.tagName);}
queryElem[queryElem.length]={name:curPrefix,e:v};}else if(v instanceof Object){this._hash2query(v,curPrefix,queryText,queryElem);}else{if(v===null)continue;if(v===true)v=1;if(v===false)v='';queryText[queryText.length]=curPrefix+"="+this.escape(''+v);}
if(formAdded&&queryElem.length>1){return this._error('must_be_single_el');}}}else{queryText[queryText.length]=content;}
return true;}
t._cleanup=function(){var ldObj=this._ldObj;if(!ldObj)return;JsHttpRequest.PENDING[ldObj.id]=false;var span=ldObj.span;if(!span)return;ldObj.span=null;var closure=function(){span.parentNode.removeChild(span);}
JsHttpRequest.setTimeout(closure,50);}
t._changeReadyState=function(s,reset){with(this){if(reset){status=statusText=responseJS=null;responseText='';}
readyState=s;if(onreadystatechange)onreadystatechange();}}
t.escape=function(s){return escape(s).replace(new RegExp('\\+','g'),'%2B');}};JsHttpRequest.COUNT=0;JsHttpRequest.MAX_URL_LEN=2000;JsHttpRequest.TIMEOUT=60000;JsHttpRequest.CACHE={};JsHttpRequest.PENDING={};JsHttpRequest.LOADERS={};JsHttpRequest._dummy=function(){};JsHttpRequest.TIMEOUTS={s:window.setTimeout,c:window.clearTimeout};JsHttpRequest.setTimeout=function(func,dt){window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.s;if(typeof(func)=="string"){id=window.JsHttpRequest_tmp(func,dt);}else{var id=null;var mediator=function(){func();delete JsHttpRequest.TIMEOUTS[id];}
id=window.JsHttpRequest_tmp(mediator,dt);JsHttpRequest.TIMEOUTS[id]=mediator;}
window.JsHttpRequest_tmp=null;return id;}
JsHttpRequest.clearTimeout=function(id){window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.c;delete JsHttpRequest.TIMEOUTS[id];var r=window.JsHttpRequest_tmp(id);window.JsHttpRequest_tmp=null;return r;}
JsHttpRequest.query=function(url,content,onready,nocache){var req=new this();req.caching=!nocache;req.onreadystatechange=function(){if(req.readyState==4){onready(req.responseJS,req.responseText);}}
req.open(null,url,true);req.send(content);}
JsHttpRequest.dataReady=function(d){var th=this.PENDING[d.id];delete this.PENDING[d.id];if(th){th._dataReady(d.text,d.js);}else if(th!==false){throw"dataReady(): unknown pending id: "+d.id;}}
JsHttpRequest.extend=function(dest,src){for(var k in src)dest[k]=src[k];}
JsHttpRequest.LOADERS.xml={loader:function(req){JsHttpRequest.extend(req._errors,{xml_no:'Cannot use XMLHttpRequest or ActiveX loader: not supported',xml_no_diffdom:'Cannot use XMLHttpRequest to load data from different domain %',xml_no_headers:'Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly',xml_no_form_upl:'Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented'});this.load=function(){if(this.queryElem.length)return['xml_no_form_upl'];if(this.url.match(new RegExp('^([a-z]+://[^\\/]+)(.*)','i'))){if(RegExp.$1.toLowerCase()!=document.location.protocol+'//'+document.location.hostname.toLowerCase()){return['xml_no_diffdom',RegExp.$1];}}
var xr=null;if(window.XMLHttpRequest){try{xr=new XMLHttpRequest()}catch(e){}}else if(window.ActiveXObject){try{xr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}
if(!xr)try{xr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}
if(!xr)return['xml_no'];var canSetHeaders=window.ActiveXObject||xr.setRequestHeader;if(!this.method)this.method=canSetHeaders&&this.queryText.length?'POST':'GET';if(this.method=='GET'){if(this.queryText)this.url+=(this.url.indexOf('?')>=0?'&':'?')+this.queryText;this.queryText='';if(this.url.length>JsHttpRequest.MAX_URL_LEN)return['url_too_long',JsHttpRequest.MAX_URL_LEN];}else if(this.method=='POST'&&!canSetHeaders){return['xml_no_headers'];}
this.url+=(this.url.indexOf('?')>=0?'&':'?')+'JsHttpRequest='+(req.caching?'0':this.id)+'-xml';var id=this.id;xr.onreadystatechange=function(){if(xr.readyState!=4)return;xr.onreadystatechange=JsHttpRequest._dummy;req.status=null;try{req.status=xr.status;req.responseText=xr.responseText;}catch(e){}
if(!req.status)return;try{var rtext=req.responseText||'{ js: null, text: null }';eval('JsHttpRequest._tmp = function(id) { var d = '+rtext+'; d.id = id; JsHttpRequest.dataReady(d); }');}catch(e){return context.ErrorHandle(id,req._errors["js_invalid"].replace('%',"<br/>"+req.responseText));}
JsHttpRequest._tmp(id);JsHttpRequest._tmp=null;};xr.open(this.method,this.url,true,this.username,this.password);if(canSetHeaders){for(var i=0;i<req._reqHeaders.length;i++){xr.setRequestHeader(req._reqHeaders[i][0],req._reqHeaders[i][1]);}
xr.setRequestHeader('Content-Type','application/octet-stream');}
xr.timeout=JsHttpRequest.TIMEOUT;xr.ontimeout=function(){return context.ErrorHandle(id,'Operation TimeOut. Try again later.');};xr.send(this.queryText);this.span=null;this.xr=xr;return null;}
this.getAllResponseHeaders=function(){return this.xr.getAllResponseHeaders();}
this.getResponseHeader=function(label){return this.xr.getResponseHeader(label);}
this.abort=function(){this.xr.abort();this.xr=null;}
this.ErrorHandle=function(id,msg){this.abort();return JsHttpRequest.dataReady({id:id,js:null,text:"<strong>JsHttpRequest Query Error</strong><br/>"+msg});}
var context=this;}}
JsHttpRequest.LOADERS.script={loader:function(req){JsHttpRequest.extend(req._errors,{script_only_get:'Cannot use SCRIPT loader: it supports only GET method',script_no_form:'Cannot use SCRIPT loader: direct form elements using and uploading are not implemented'})
this.load=function(){if(this.queryText)this.url+=(this.url.indexOf('?')>=0?'&':'?')+this.queryText;this.url+=(this.url.indexOf('?')>=0?'&':'?')+'JsHttpRequest='+this.id+'-'+'script';this.queryText='';if(!this.method)this.method='GET';if(this.method!=='GET')return['script_only_get'];if(this.queryElem.length)return['script_no_form'];if(this.url.length>JsHttpRequest.MAX_URL_LEN)return['url_too_long',JsHttpRequest.MAX_URL_LEN];var th=this,d=document,s=null,b=d.body;if(!window.opera){this.span=s=d.createElement('SCRIPT');var closure=function(){s.language='JavaScript';if(s.setAttribute)s.setAttribute('src',th.url);else s.src=th.url;b.insertBefore(s,b.lastChild);}}else{this.span=s=d.createElement('SPAN');s.style.display='none';b.insertBefore(s,b.lastChild);s.innerHTML='Workaround for IE.<s'+'cript></'+'script>';var closure=function(){s=s.getElementsByTagName('SCRIPT')[0];s.language='JavaScript';if(s.setAttribute)s.setAttribute('src',th.url);else s.src=th.url;}}
JsHttpRequest.setTimeout(closure,10);return null;}}}
JsHttpRequest.LOADERS.form={loader:function(req){JsHttpRequest.extend(req._errors,{form_el_not_belong:'Element "%" does not belong to any form!',form_el_belong_diff:'Element "%" belongs to a different form. All elements must belong to the same form!',form_el_inv_enctype:'Attribute "enctype" of the form must be "%" (for IE), "%" given.'})
this.load=function(){var th=this;if(!th.method)th.method='POST';th.url+=(th.url.indexOf('?')>=0?'&':'?')+'JsHttpRequest='+th.id+'-'+'form';if(th.method=='GET'){if(th.queryText)th.url+=(th.url.indexOf('?')>=0?'&':'?')+th.queryText;if(th.url.length>JsHttpRequest.MAX_URL_LEN)return['url_too_long',JsHttpRequest.MAX_URL_LEN];var p=th.url.split('?',2);th.url=p[0];th.queryText=p[1]||'';}
var form=null;var wholeFormSending=false;if(th.queryElem.length){if(th.queryElem[0].e.tagName.toUpperCase()=='FORM'){form=th.queryElem[0].e;wholeFormSending=true;th.queryElem=[];}else{form=th.queryElem[0].e.form;for(var i=0;i<th.queryElem.length;i++){var e=th.queryElem[i].e;if(!e.form){return['form_el_not_belong',e.name];}
if(e.form!=form){return['form_el_belong_diff',e.name];}}}
if(th.method=='POST'){var need="multipart/form-data";var given=(form.attributes.encType&&form.attributes.encType.nodeValue)||(form.attributes.enctype&&form.attributes.enctype.value)||form.enctype;if(given!=need){return['form_el_inv_enctype',need,given];}}}
var d=form&&(form.ownerDocument||form.document)||document;var ifname='jshr_i_'+th.id;var s=th.span=d.createElement('DIV');s.style.position='absolute';s.style.display='none';s.style.visibility='hidden';s.innerHTML=(form?'':'<form'+(th.method=='POST'?' enctype="multipart/form-data" method="post"':'')+'></form>')+'<iframe name="'+ifname+'" id="'+ifname+'" style="width:0px; height:0px; overflow:hidden; border:none"></iframe>'
if(!form){form=th.span.firstChild;}
d.body.insertBefore(s,d.body.lastChild);var setAttributes=function(e,attr){var sv=[];var form=e;if(e.mergeAttributes){var form=d.createElement('form');form.mergeAttributes(e,false);}
for(var i=0;i<attr.length;i++){var k=attr[i][0],v=attr[i][1];if(k=='target'){sv[sv.length]=[k,form.target];form.target=v;}else{sv[sv.length]=[k,form.getAttribute(k)];form.setAttribute(k,v);}}
if(e.mergeAttributes){e.mergeAttributes(form,false);}
return sv;}
var closure=function(){top.JsHttpRequestGlobal=JsHttpRequest;var savedNames=[];if(!wholeFormSending){for(var i=0,n=form.elements.length;i<n;i++){savedNames[i]=form.elements[i].name;form.elements[i].name='';}}
var qt=th.queryText.split('&');for(var i=qt.length-1;i>=0;i--){var pair=qt[i].split('=',2);var e=d.createElement('INPUT');e.type='hidden';e.name=unescape(pair[0]);e.value=pair[1]!=null?unescape(pair[1]):'';form.appendChild(e);}
for(var i=0;i<th.queryElem.length;i++){th.queryElem[i].e.name=th.queryElem[i].name;}
var sv=setAttributes(form,[['action',th.url],['method',th.method],['onsubmit',null],['target',ifname]]);form.submit();setAttributes(form,sv);for(var i=0;i<qt.length;i++){form.lastChild.parentNode.removeChild(form.lastChild);}
if(!wholeFormSending){for(var i=0,n=form.elements.length;i<n;i++){form.elements[i].name=savedNames[i];}}}
JsHttpRequest.setTimeout(closure,100);return null;}}}})(window);
